<div class="container mat-elevation-z2">
  <h2 class="title">Gerenciamento de Clientes</h2>

  <form class="form" [formGroup]="formCliente">
    <mat-form-field class="form-group">
      <mat-label>Nome</mat-label>
      <input matInput id="nome" name="nome" [(ngModel)]="cliente.nome" placeholder="Nome" formControlName="nome">
    </mat-form-field>
    <mat-form-field class="form-group">
      <mat-label>Tipo</mat-label>
      <mat-select id="tipo" name="tipo" [(ngModel)]="cliente.tipo" (change)="pessoaFisicaOuJuridica()"
        formControlName="tipo">
        <mat-option *ngFor="let tipo of tipos" [value]="tipo.nome">{{ tipo.nome }}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field class="form-group">
      <mat-label>{{ placeholderDocumento }}</mat-label>
      <input matInput type="text" id="documento" name="documento" [(ngModel)]="cliente.documento"
        [mask]="cliente.tipo === 'Pessoa Jurídica' ? '00.000.000/0000-00' : '000.000.000-00'"
        [placeholder]="placeholderDocumento" formControlName="documento">
    </mat-form-field>
    <mat-form-field class="form-group">
      <mat-label>{{ placeholderrgOuIe }}</mat-label>
      <input matInput type="text" id="rgOuIe" name="rgOuIe" [(ngModel)]="cliente.rgOuIe"
        placeholder="{{ placeholderrgOuIe }}" formControlName="rgOuIe">
    </mat-form-field>
    <div class="btn-group">
      <button mat-raised-button *ngIf="btnCadastro" [disabled]="formCliente.invalid" color="primary"
        (click)="cadastrar()">Cadastrar</button>
      <button mat-raised-button *ngIf="!btnCadastro" [disabled]="formCliente.invalid" color="primary"
        (click)="editar()">Editar</button>
      <button mat-raised-button *ngIf="!btnCadastro" color="primary" (click)="cancelar()">Cancelar</button>
    </div>
  </form><br>

  <div class="pesquisa mb-3">
    <input type="text" class="form-control" [(ngModel)]="termoBusca" placeholder="Buscar por nome"
      (input)="filtrarClientesPorNome()">
    <button class="btn btn-secondary" (click)="limparBusca()">Limpar</button>
  </div>

  <div class="btn-group">
    <button class="btn" [ngClass]="filtroAtual === 'ativos' ? 'btn-selected' : ''" (click)="filtrarClientes('ativos')">Ativos</button>
    <button class="btn" [ngClass]="filtroAtual === 'inativos' ? 'btn-selected' : ''" (click)="filtrarClientes('inativos')">Inativos</button>
    <button class="btn" [ngClass]="filtroAtual === 'todos' ? 'btn-selected' : ''" (click)="filtrarClientes('todos')">Todos</button>
  </div>


  <table class="table table-bordered" *ngIf="tabela">
    <thead class="thead-light">
      <tr>
        <th>#</th>
        <th>Nome</th>
        <th>Tipo</th>
        <th>Telefone</th>
        <th>Documento</th>
        <th>RG ou IE</th>
        <th>Data de Cadastro</th>
        <th>Ativo</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let c of clientes; index as i">
        <td>{{ i + 1 }}</td>
        <td>{{ c.nome }}</td>
        <td>{{ c.tipo }}</td>
        <td>
          <ul class="list-unstyled">
            <li *ngFor="let telefone of c.telefones; let idx = index">
              {{ telefone | mask: '(00) 0000-0000' }}
              <button class="btn btn-danger btn-sm" (click)="removerTelefone(c, idx)">Remover</button>
            </li>
          </ul>
          <div class="input-group">
            <input type="text" class="form-control" [(ngModel)]="c.novoTelefone" placeholder="Novo Telefone"
              mask="(00) 0000-0000">
            <div class="input-group-append">
              <button class="btn btn-primary" (click)="adicionarTelefone(c)">Adicionar</button>
            </div>
          </div>
        </td>
        <td>{{ c.tipo === 'Pessoa Jurídica' ? (c.documento | mask:'00.000.000/0000-00') : (c.documento |
          mask:'000.000.000-00') }}</td>
        <td>{{ c.rgOuIe }}</td>
        <td>{{ c.dataCadastro | date:'dd/MM/yyyy' }}</td>
        <td>
          <button class="btn" [ngClass]="{'btn-success': c.ativo, 'btn-danger': !c.ativo}"
            (click)="alternarAtivoCliente(c)">{{ c.ativo ? 'Ativo' : 'Inativo' }}</button>
        </td>
        <td>
          <button class="btn btn-success" (click)="selecionarCliente(i)">Editar</button>
          <button class="btn btn-danger" (click)="removerCliente(c)">Excluir</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
